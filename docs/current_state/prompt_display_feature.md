# Prompt Display Feature

## Overview

The prompt display feature provides a "View Prompt" button on each generated image that allows users to inspect the exact AI generation prompt that was used (or will be used) to create that specific image. This feature supports the development workflow by enabling rapid iteration and refinement of prompts between MVP and 1.0 release.

## User Interface

### Button Placement

The "View Prompt" button appears in the actions section of each generated image card, alongside existing "Download" and "Regenerate" buttons. This placement provides:

- **Contextual access**: Each image has its own unique prompt, so the button is positioned with the relevant image
- **Consistent UI**: Follows existing action button patterns in the GeneratedImages component
- **Ease of discovery**: Visible without cluttering the interface

### Modal Display

When clicked, the button opens a modal dialog that displays:

- **Prompt text**: The full AI generation prompt in a monospace font for readability
- **Viewpoint identification**: The specific viewpoint (e.g., "Helicopter North", "Ground South") in the modal header
- **Close interactions**: Multiple ways to dismiss:
  - Close button (X) in top-right corner
  - Click outside the modal on the overlay
  - Press ESC key

## Technical Implementation

### Component Architecture

**PromptModal Component** (`apps/web/src/components/GeneratedImages/PromptModal.tsx`):

- React functional component with TypeScript
- Props: `prompt` (string), `viewpoint` (string), `onClose` (callback)
- Follows the same modal pattern as `ImageLightbox` for consistency
- Keyboard event handling for ESC key
- Click-outside-to-close behavior

**Styling** (`apps/web/src/components/GeneratedImages/PromptModal.module.css`):

- Fixed overlay with semi-transparent background (z-index: 9999)
- Modal centered with max-width of 800px
- Scrollable content area for long prompts
- Monospace font with syntax highlighting background
- Responsive design with mobile support

**Integration** (`apps/web/src/components/GeneratedImages/GeneratedImages.tsx`):

- State management: `promptModalData` stores current prompt and viewpoint
- Handlers: `showPromptModal()` and `closePromptModal()` control visibility
- Button rendered in `.actions` section of both anchor and regular image cards
- Prompt sourced from `image.metadata.prompt`

### Data Flow

```typescript
GeneratedImage
  └─ metadata
      └─ prompt: string  // Full prompt text stored here

GeneratedImages Component
  └─ State: promptModalData { prompt, viewpoint }
  └─ Handler: showPromptModal(prompt, viewpoint)
  └─ Modal: PromptModal (conditionally rendered)
```

### Prompt Storage

Prompts are stored at the **image level**, not the scenario level:

- Each `GeneratedImage` object contains `metadata.prompt` (string)
- This allows different viewpoints to have customized prompts if needed
- The `ScenarioMetadata` only stores `promptVersion` (template version ID) for tracking which template was used
- Prompts are generated by the `promptGenerator` in the `@fire-sim/shared` package

## Testing

**Unit Tests** (`apps/web/src/components/GeneratedImages/__tests__/PromptModal.test.tsx`):

- Renders with prompt text
- Close button functionality
- Overlay click to close
- ESC key to close
- Viewpoint name formatting (e.g., "helicopter_north" → "Helicopter North")

**Test Coverage**:

- All close behaviors verified
- Component rendering validated
- Props correctly passed and displayed

## Usage Scenarios

### For Developers (Pre-1.0)

- **Prompt iteration**: Quickly view prompts to understand what's being requested
- **Quality assurance**: Compare prompts across viewpoints to ensure consistency
- **Debugging**: Identify issues with prompt generation or templating

### For Trainers (Post-1.0)

- **Transparency**: Understand how AI generates specific images
- **Training material**: Use prompts as teaching examples for fire behavior
- **Feedback**: Provide informed feedback on image accuracy

## Future Enhancements

Potential improvements for future iterations:

1. **Copy to clipboard**: Add button to copy prompt text
2. **Prompt editing**: Allow live editing and regeneration with modified prompts
3. **Prompt comparison**: Side-by-side comparison of prompts across viewpoints
4. **Prompt history**: Show prompt versions if image was regenerated
5. **Syntax highlighting**: Highlight key sections of the prompt (scene, fire, weather, etc.)

## Related Documentation

- **Prompt Generation**: See `packages/shared/src/prompts/promptGenerator.ts`
- **Prompt Templates**: See `packages/shared/src/prompts/promptTemplates.ts`
- **Prompt Quality Standards**: See `docs/prompt_quality_standards.md`
- **ADR-005**: Prompt Versioning Strategy in `docs/adr/ADR-005-prompt-versioning-strategy.md`

## Implementation History

- **Created**: 2026-02-16
- **Issue**: Add button to display prompt for a given scenario
- **Components Added**:
  - `PromptModal.tsx` - Modal component for displaying prompts
  - `PromptModal.module.css` - Styling for the modal
  - `PromptModal.test.tsx` - Unit tests
- **Components Modified**:
  - `GeneratedImages.tsx` - Added button and modal integration
  - `GeneratedImages.module.css` - Added button styles
